// Словарь русских слов для проверки осмысленности
const russianDictionary = new Set([
    // Основные товарные категории и группы
    'одежда', 'обувь', 'аксессуары', 'электроника', 'гаджеты', 'смартфоны', 'ноутбуки',
    'бытовая', 'техника', 'посуда', 'мебель', 'игрушки', 'детские', 'товары',
    'продукты', 'питание', 'косметика', 'парфюмерия', 'уход', 'здоровье',
    'книги', 'канцтовары', 'спорт', 'инвентарь', 'велосипеды', 'автотовары',
    'запчасти', 'строительные', 'материалы', 'инструменты', 'сад', 'огород',
    'животные', 'корма', 'ветаптека', 'цветы', 'подарки', 'украшения',
    'часы', 'сумки', 'рюкзаки', 'школа', 'учеба', 'компьютеры', 'мониторы',
    'принтеры', 'сканеры', 'фотоаппараты', 'видеокамеры', 'телевизоры',
    'дом', 'интерьер', 'ремонт', 'освещение', 'текстиль', 'одеяло', 'подушки',
    'одежда для детей', 'обувь для детей', 'игры', 'настольные', 'конструкторы',
    'велосипед', 'самокат', 'ролики', 'скейт', 'мото', 'авто', 'запчасти',
    'мясо', 'рыба', 'овощи', 'фрукты', 'молоко', 'сыр', 'йогурт', 'хлеб',
    'торты', 'выпечка', 'напитки', 'чай', 'кофе', 'соки', 'вода',
    // Общие слова для товаров
    'товар', 'группа', 'категория', 'продукция', 'ассортимент', 'позиция',
    'продажа', 'услуга', 'продукт', 'бренд', 'марка', 'серия', 'линейка',
    // Слова для осмысленности
    'да', 'нет', 'есть', 'нету', 'основной', 'главный', 'самый', 'больше', 'доход', 'прибыль',
    // Должности для этапа "какую должность вы занимаете в компании"
    'директор', 'генеральный директор', 'руководитель', 'менеджер', 'маркетолог', 'владелец', 'собственник', 'учредитель', 'коммерческий директор', 'исполнительный директор', 'финансовый директор', 'главный бухгалтер', 'бухгалтер', 'администратор', 'разработчик', 'программист', 'дизайнер', 'руководитель отдела', 'начальник отдела', 'отдел продаж', 'менеджер по продажам', 'менеджер проекта', 'project manager', 'seo-специалист', 'контент-менеджер', 'ассистент', 'заместитель директора', 'маркетинг директор', 'бренд-менеджер', 'продакт-менеджер', 'аналитик', 'hr', 'hr-менеджер', 'рекрутер', 'логист', 'оператор', 'секретарь', 'помощник',
]);

// Словарь английских слов для проверки осмысленности
const englishDictionary = new Set([
    'yes', 'no', 'hello', 'bye', 'thanks', 'please',
    'good', 'bad', 'help', 'tell', 'show', 'make',
    'find', 'buy', 'sell', 'order', 'deliver',
    // Сервисы рассылок
    'unisender', 'mindbox', 'sendsay', 'dashamail', 'mailopost'
    // Здесь можно добавить больше слов
]);

// Список запрещенных слов (маты и оскорбления)
const forbiddenWords = new Set([
    // Здесь нужно добавить список запрещенных слов
]);

export class TextValidator {
    // Проверка на наличие запрещенных слов
    static hasForbiddenWords(text) {
        const words = text.toLowerCase().split(/\s+/);
        return words.some(word => forbiddenWords.has(word));
    }

    // Проверка на осмысленность текста
    static isMeaningfulText(text) {
        const words = text.toLowerCase().split(/\s+/);
        const meaningfulWords = words.filter(word => 
            russianDictionary.has(word) || 
            englishDictionary.has(word)
        );
        
        // Считаем текст осмысленным, если хотя бы 50% слов есть в словаре
        return meaningfulWords.length >= words.length * 0.5;
    }

    // Проверка на случайный набор символов
    static isRandomText(text) {
        // Проверка на повторяющиеся символы
        const repeatedChars = /(.)\1{2,}/;
        if (repeatedChars.test(text)) {
            return true;
        }

        // Проверка на отсутствие гласных в русском тексте
        const russianVowels = /[аеёиоуыэюя]/i;
        if (!russianVowels.test(text)) {
            return true;
        }

        return false;
    }

    // Проверка соответствия ручного ввода быстрым ответам
    static matchesQuickResponse(text, quickResponses) {
        return quickResponses.some(response => 
            response.toLowerCase() === text.toLowerCase()
        );
    }

    // Основная функция валидации
    static validateText(text, quickResponses = []) {
        // Проверка на пустой текст
        if (!text || text.trim().length === 0) {
            return {
                isValid: false,
                error: 'Текст не может быть пустым'
            };
        }

        // Если есть быстрые ответы, проверяем соответствие и больше ничего не проверяем, кроме запрещённых слов
        if (quickResponses.length > 0) {
            if (this.matchesQuickResponse(text, quickResponses)) {
                // Проверка на запрещённые слова
                if (this.hasForbiddenWords(text)) {
                    return {
                        isValid: false,
                        error: 'Текст содержит запрещенные слова'
                    };
                }
                return {
                    isValid: true,
                    error: null
                };
            } else {
                return {
                    isValid: false,
                    error: 'Пожалуйста, выберите один из предложенных вариантов ответа',
                    quickResponses: quickResponses
                };
            }
        }

        // Проверка на запрещенные слова
        if (this.hasForbiddenWords(text)) {
            return {
                isValid: false,
                error: 'Текст содержит запрещенные слова'
            };
        }

        // Проверка на случайный набор символов
        if (this.isRandomText(text)) {
            return {
                isValid: false,
                error: 'Текст похож на случайный набор символов'
            };
        }

        // Проверка на осмысленность
        if (!this.isMeaningfulText(text)) {
            return {
                isValid: false,
                error: 'Текст не является осмысленным'
            };
        }

        return {
            isValid: true,
            error: null
        };
    }
} 